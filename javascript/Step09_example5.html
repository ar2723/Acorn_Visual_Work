<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Step09_example5.html</title>
      <style>
            canvas {
                  border: 1px solid red;
            }
      </style>
</head>
<body>
      <h1>canvas 요소 활용해보기</h1>
      <!-- canvas 요소는 width와 height를 속성으로 직접 지정할 수 있다. -->
      <canvas id="myCanvas" width="800" height="500"></canvas>
      <script>
            //canvas 요소의 참조값
            const canvas = document.querySelector("#myCanvas");
            //canvas에 그림을 그릴 도구(context) 객체 얻어내기
            const context = canvas.getContext("2d");

            //canvas에 그릴 이미지 로딩하기
            // new image() 이 부분은 자바스크립트로 이미지를 생성하는 것이라 보면 된다.
            const snipeImg = new Image();
            snipeImg.src="images/snipe.png";
            const holeImg = new Image();
            holeImg.src = "images/hole.png";
            const backImg = new Image();
            backImg.src = "images/background.jpg";
            
            //snipe의 좌표
            let snipeX = 0, snipeY = 0;
            //총알 구멍의 임시 좌표
            let holeX = 0, holeY = 0;

            //총알 구멍 좌표가 저장되는 배열
            const bullets = [];

            setInterval(
                  () => {
                        //여기 함수 내부는 1/100초 마다 한번씩 실행된다.
                        // context.clearRect(0, 0, 800 , 500);
                        // 배경이미지를 canvas 의 크기에 맞게 그린다.
                        context.drawImage(backImg, 0, 0, 800, 500);

                        for(let i = 0; i < bullets.length; i++){
                              let tmp = bullets[i];
                              context.drawImage(holeImg, tmp.x - 10, tmp.y - 10, 20, 20);
                        }
                        context.drawImage(snipeImg, snipeX - 50, snipeY - 50, 100, 100);
                  }
            , 10);

            //canvas 요소의 mousemove 이벤트 처리
            canvas.addEventListener("mousemove", 
                  (event) => {
                        //이벤트가 발생한 곳의 canvas 내에서의 좌표
                        snipeX = event.offsetX ;
                        snipeY = event.offsetY ;
                        //지정된 사각형 영역을 지우기 clearRect(x, y, width, height);
                        //여기서 snipeX, snipeY 값은 좌상단의 기준점
                  }
            )
            canvas.addEventListener("mousedown",
                  (event) => {
                        //이벤트가 발생한 곳의 좌표를 object에 담는다.
                        const holes = {x : event.offsetX, y : event.offsetY}
                        //좌표 object를 배열에 추가한다
                        bullets.push(holes)
                  }
            )
      </script>
</body>
</html>